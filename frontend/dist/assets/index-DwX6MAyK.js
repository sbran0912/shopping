(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();class w{baseUrl;constructor(){this.baseUrl="http://192.168.178.67:8080"}async getArtikel(){try{const e=await fetch(`${this.baseUrl}/artikel`);if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()||[]}catch(e){throw console.error("Fehler beim Laden der Artikel:",e),new Error("Backend nicht erreichbar. LÃ¤uft der Server auf Port 8080?")}}async getListen(){try{const e=await fetch(`${this.baseUrl}/listen`);if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()||[]}catch(e){throw console.error("Fehler beim Laden der Listen:",e),new Error("Backend nicht erreichbar. LÃ¤uft der Server auf Port 8080?")}}async createListe(e){const t=await fetch(`${this.baseUrl}/listen`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bezeichnung:e})});if(!t.ok)throw new Error("Fehler beim Erstellen der Liste");return t.json()}async deleteListe(e){if(!(await fetch(`${this.baseUrl}/listen/${e}`,{method:"DELETE"})).ok)throw new Error("Fehler beim LÃ¶schen der Liste")}async getPositionen(e){try{const t=await fetch(`${this.baseUrl}/listen/${e}/positionen`);if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()||[]}catch(t){throw console.error("Fehler beim Laden der Positionen:",t),t}}async createPosition(e,t,i){const n=await fetch(`${this.baseUrl}/listen/${e}/positionen`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({artikel_name:t,bemerkung:i})});if(!n.ok)throw new Error("Fehler beim Erstellen der Position");return n.json()}async updatePosition(e,t){const i=await fetch(`${this.baseUrl}/positionen/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error("Fehler beim Aktualisieren der Position");return i.json()}async deletePosition(e){if(!(await fetch(`${this.baseUrl}/positionen/${e}`,{method:"DELETE"})).ok)throw new Error("Fehler beim LÃ¶schen der Position")}}const d=new w;function s(a,e,...t){const i=document.createElement(a);return e&&(Object.entries(e).forEach(([n,r])=>{if(n==="className")i.className=r;else if(n!=="children")if(n.startsWith("on")&&typeof r=="function"){const l=n.substring(2).toLowerCase();i.addEventListener(l,r)}else i[n]=r}),e.children&&(t=[...e.children,...t])),t.forEach(n=>{typeof n=="string"?i.appendChild(document.createTextNode(n)):i.appendChild(n)}),i}function p(a){for(;a.firstChild;)a.removeChild(a.firstChild)}class v{constructor(e,t,i){this.liste=e,this.selected=t,this.onSelect=i}render(){const e=new Date(this.liste.erstellt_am).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}),t=s("button",{className:`list-group-item list-group-item-action ${this.selected?"active":""}`,onclick:this.onSelect}),i=s("div",{className:"d-flex w-100 justify-content-between align-items-center"});i.appendChild(s("h6",{className:"mb-1 fw-bold"},this.liste.bezeichnung));const n=s("small",{className:this.selected?"text-white-50":"text-muted"},`ðŸ“… ${e}`);return i.appendChild(n),t.appendChild(i),t}}class y{element;startX=0;startY=0;currentX=0;isDragging=!1;options;constructor(e,t){this.element=e,this.options={threshold:100,...t},this.attach()}attach(){this.element.addEventListener("touchstart",this.handleTouchStart),this.element.addEventListener("touchmove",this.handleTouchMove),this.element.addEventListener("touchend",this.handleTouchEnd),this.element.addEventListener("mousedown",this.handleMouseDown)}handleTouchStart=e=>{this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY,this.isDragging=!0,this.element.style.transition="none"};handleTouchMove=e=>{if(!this.isDragging)return;this.currentX=e.touches[0].clientX-this.startX;const t=e.touches[0].clientY-this.startY;Math.abs(this.currentX)>Math.abs(t)&&(e.preventDefault(),this.element.style.transform=`translateX(${this.currentX}px)`,this.currentX<-50?this.element.style.backgroundColor="rgba(214, 48, 49, 0.1)":this.element.style.backgroundColor="")};handleTouchEnd=()=>{if(!this.isDragging)return;this.element.style.transition="transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s";const e=this.options.threshold||100;this.currentX<-e&&this.options.onSwipeLeft?(this.element.style.transform="translateX(-100%)",this.element.style.opacity="0",setTimeout(()=>{this.options.onSwipeLeft()},300)):this.currentX>e&&this.options.onSwipeRight?(this.options.onSwipeRight(),this.reset()):this.reset(),this.isDragging=!1,this.currentX=0};handleMouseDown=e=>{this.startX=e.clientX,this.isDragging=!0,this.element.style.transition="none";const t=n=>{this.isDragging&&(this.currentX=n.clientX-this.startX,this.element.style.transform=`translateX(${this.currentX}px)`,this.currentX<-50?this.element.style.backgroundColor="rgba(214, 48, 49, 0.1)":this.element.style.backgroundColor="")},i=()=>{this.handleTouchEnd(),document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",i)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",i)};reset(){this.element.style.transform="",this.element.style.backgroundColor="",this.element.style.opacity=""}destroy(){this.element.removeEventListener("touchstart",this.handleTouchStart),this.element.removeEventListener("touchmove",this.handleTouchMove),this.element.removeEventListener("touchend",this.handleTouchEnd),this.element.removeEventListener("mousedown",this.handleMouseDown)}}class C{constructor(e,t,i){this.position=e,this.onToggle=t,this.onDelete=i}render(){const e=s("div",{className:`list-group-item d-flex justify-content-between align-items-center position-relative overflow-hidden ${this.position.erledigt?"bg-light text-muted":""}`}),t=s("div",{className:"form-check m-0 d-flex align-items-center flex-grow-1"}),i=s("input",{className:"form-check-input me-3 fs-5",type:"checkbox",checked:this.position.erledigt,onchange:o=>{o.stopPropagation(),this.onToggle(this.position.id,this.position.erledigt)}});i.onclick=o=>o.stopPropagation(),t.appendChild(i);const n=s("div",{}),r=this.position.erledigt?"text-decoration-line-through":"fw-medium";n.appendChild(s("div",{className:r},this.position.artikel_name)),this.position.bemerkung&&n.appendChild(s("small",{className:"text-muted d-block"},this.position.bemerkung)),t.appendChild(n),e.appendChild(t);const l=s("button",{className:"btn btn-outline-danger btn-sm border-0",onclick:o=>{o.stopPropagation(),this.onDelete(this.position.id)}},"ðŸ—‘ï¸");return e.appendChild(l),new y(e,{onSwipeLeft:()=>{this.onDelete(this.position.id)},threshold:100}),e}}class N{constructor(e,t){this.artikel=e,this.onAdd=t}artikelInput=null;bemerkungInput=null;suggestionsContainer=null;render(){const e=s("form",{className:"card p-3 mb-3 bg-light border-0"}),t=s("div",{className:"row g-2"}),i=s("div",{className:"col-md-6 position-relative"});this.artikelInput=s("input",{type:"text",className:"form-control",placeholder:"Artikel hinzufÃ¼gen...",required:!0,autocomplete:"off"}),this.artikelInput.addEventListener("input",()=>this.handleArtikelInput()),this.artikelInput.addEventListener("focus",()=>this.showSuggestions()),this.artikelInput.addEventListener("blur",()=>{setTimeout(()=>this.hideSuggestions(),200)}),i.appendChild(this.artikelInput),this.suggestionsContainer=s("div",{className:"list-group position-absolute w-100 shadow-sm"}),this.suggestionsContainer.style.zIndex="1000",this.suggestionsContainer.style.display="none",i.appendChild(this.suggestionsContainer),t.appendChild(i);const n=s("div",{className:"col-md-4"});this.bemerkungInput=s("input",{type:"text",className:"form-control",placeholder:"Bemerkung (optional)"}),n.appendChild(this.bemerkungInput),t.appendChild(n);const r=s("div",{className:"col-md-2"}),l=s("button",{type:"submit",className:"btn btn-primary w-100"},"+");return r.appendChild(l),t.appendChild(r),e.appendChild(t),e.addEventListener("submit",o=>{o.preventDefault(),this.handleSubmit()}),e}handleArtikelInput(){if(!this.artikelInput||!this.suggestionsContainer)return;const e=this.artikelInput.value.toLowerCase(),t=this.artikel.filter(i=>i.name.toLowerCase().includes(e)).slice(0,5);this.renderSuggestions(t)}showSuggestions(){this.artikelInput&&this.artikelInput.value&&this.handleArtikelInput()}hideSuggestions(){this.suggestionsContainer&&(this.suggestionsContainer.style.display="none")}renderSuggestions(e){if(this.suggestionsContainer){if(p(this.suggestionsContainer),e.length===0){this.suggestionsContainer.style.display="none";return}e.forEach(t=>{const i=s("button",{type:"button",className:"list-group-item list-group-item-action",onclick:()=>this.selectArtikel(t.name)},t.name);this.suggestionsContainer.appendChild(i)}),this.suggestionsContainer.style.display="block"}}selectArtikel(e){this.artikelInput&&(this.artikelInput.value=e,this.hideSuggestions(),this.bemerkungInput?.focus())}handleSubmit(){if(!this.artikelInput||!this.bemerkungInput)return;const e=this.artikelInput.value.trim(),t=this.bemerkungInput.value.trim();e&&(this.onAdd(e,t),this.artikelInput.value="",this.bemerkungInput.value="",this.hideSuggestions())}}class L{constructor(e,t,i){this.title=e,this.placeholder=t,this.onSubmit=i}modalElement=null;inputElement=null;render(){const e=s("div",{className:"modal-backdrop fade show",onclick:()=>this.close()}),t=s("div",{className:"modal fade show d-block",tabIndex:-1,role:"dialog",onclick:u=>{u.target===t&&this.close()}}),i=s("div",{className:"modal-dialog modal-dialog-centered"}),n=s("div",{className:"modal-content shadow"}),r=s("div",{className:"modal-header"});r.appendChild(s("h5",{className:"modal-title"},this.title));const l=s("button",{type:"button",className:"btn-close",onclick:()=>this.close()});r.appendChild(l),n.appendChild(r);const o=s("div",{className:"modal-body"}),h=s("form",{onsubmit:u=>{u.preventDefault(),this.handleSubmit()}});this.inputElement=s("input",{type:"text",className:"form-control",placeholder:this.placeholder,required:!0}),h.appendChild(this.inputElement),o.appendChild(h),n.appendChild(o);const m=s("div",{className:"modal-footer"}),f=s("button",{type:"button",className:"btn btn-secondary",onclick:()=>this.close()},"Abbrechen"),b=s("button",{type:"button",className:"btn btn-primary",onclick:()=>this.handleSubmit()},"Erstellen");m.appendChild(f),m.appendChild(b),n.appendChild(m),i.appendChild(n),t.appendChild(i);const c=s("div",{});return c.appendChild(e),c.appendChild(t),this.modalElement=c,setTimeout(()=>this.inputElement?.focus(),100),c}handleSubmit(){if(!this.inputElement)return;const e=this.inputElement.value.trim();e&&(this.onSubmit(e),this.close())}close(){this.modalElement&&this.modalElement.parentElement&&this.modalElement.parentElement.removeChild(this.modalElement)}}class k{container;listen=[];selectedListe=null;positionen=[];artikel=[];error=null;loading=!1;constructor(e){this.container=e,this.init()}async init(){await this.loadData(),this.render()}async loadData(){this.loading=!0,this.error=null;try{[this.listen,this.artikel]=await Promise.all([d.getListen(),d.getArtikel()]),this.listen.length>0&&!this.selectedListe&&await this.selectListe(this.listen[0])}catch(e){console.error("Fehler beim Laden:",e),this.error=e instanceof Error?e.message:"Unbekannter Fehler"}this.loading=!1,this.render()}async selectListe(e){this.selectedListe=e,this.loading=!0,this.render();try{this.positionen=await d.getPositionen(e.id)}catch(t){console.error("Fehler beim Laden der Positionen:",t)}this.loading=!1,this.render()}async createListe(e){try{const t=await d.createListe(e);this.listen=[...this.listen,t],await this.selectListe(t),this.render()}catch(t){console.error("Fehler beim Erstellen:",t),alert("Fehler beim Erstellen der Liste")}}async deleteListe(){if(this.selectedListe)try{await d.deleteListe(this.selectedListe.id),this.listen=this.listen.filter(e=>e.id!==this.selectedListe.id),this.selectedListe=null,this.positionen=[],this.listen.length>0?await this.selectListe(this.listen[0]):this.render()}catch(e){console.error("Fehler beim LÃ¶schen:",e),alert("Fehler beim LÃ¶schen der Liste")}}async togglePosition(e,t){try{await d.updatePosition(e,{erledigt:!t}),this.positionen=this.positionen.map(i=>i.id===e?{...i,erledigt:!t}:i),this.render()}catch(i){console.error("Fehler beim Aktualisieren:",i)}}async deletePosition(e){try{await d.deletePosition(e),this.positionen=this.positionen.filter(t=>t.id!==e),this.render()}catch(t){console.error("Fehler beim LÃ¶schen:",t)}}async addPosition(e,t){if(this.selectedListe)try{const i=await d.createPosition(this.selectedListe.id,e,t);this.positionen=[...this.positionen,i],this.render()}catch(i){console.error("Fehler beim HinzufÃ¼gen:",i),alert("Fehler beim HinzufÃ¼gen der Position")}}getStats(){const e=this.positionen.length,t=this.positionen.filter(n=>n.erledigt).length,i=e-t;return{total:e,done:t,open:i}}renderHeader(){const e=s("div",{className:"container py-4 text-center"});return e.style.animation="slideDown 0.8s ease-out",e.appendChild(s("h1",{className:"display-5 fw-bold text-primary"},"ðŸ›’ Einkaufsliste")),e.appendChild(s("p",{className:"lead text-muted"},"Organisiere deine EinkÃ¤ufe")),e}renderErrorBanner(){return this.error?s("div",{className:"alert alert-danger m-3 shadow-sm"},s("h4",{className:"alert-heading"},"âš ï¸ Verbindungsfehler"),s("p",{className:"mb-0"},this.error),s("div",{className:"mt-2 small text-muted"},s("strong",{},"So behebst du das Problem:"),document.createTextNode(" 1. Stelle sicher, dass das Backend lÃ¤uft: "),s("code",{},"go run main.go"),s("br"),document.createTextNode("2. Backend sollte auf Port 8080 laufen"),s("br"),document.createTextNode("3. ÃœberprÃ¼fe die Console fÃ¼r Details"))):null}renderSidebar(){const e=s("div",{className:"col-md-4 col-lg-3 bg-light p-0 sidebar-wrapper"}),t=s("div",{className:"d-flex justify-content-between align-items-center p-3 border-bottom bg-white"},s("h5",{className:"m-0"},"Meine Listen"),s("button",{className:"btn btn-primary btn-sm",onclick:()=>this.showNewListModal()},"+ Neu"));if(e.appendChild(t),this.loading&&this.listen.length===0)e.appendChild(s("div",{className:"p-4 text-center text-muted"},"Lade Listen..."));else if(this.listen.length===0)e.appendChild(s("div",{className:"text-center p-5 text-muted"},s("div",{className:"h1"},"ðŸ“"),s("p",{},"Noch keine Listen vorhanden")));else{const i=s("div",{className:"list-group list-group-flush"});this.listen.forEach(n=>{const r=new v(n,this.selectedListe?.id===n.id,()=>this.selectListe(n));i.appendChild(r.render())}),e.appendChild(i)}return e}renderMainContent(){const e=s("div",{className:"col-md-8 col-lg-9 p-3 p-md-4"});if(!this.selectedListe)return e.appendChild(s("div",{className:"text-center mt-5 text-muted"},s("div",{className:"display-1 mb-3"},"ðŸ›’"),s("h3",{},"WÃ¤hle eine Liste"),s("p",{},"oder erstelle eine neue"))),e;const t=s("div",{className:"d-flex justify-content-between align-items-center mb-4"},s("h2",{className:"m-0"},this.selectedListe.bezeichnung),s("button",{className:"btn btn-outline-danger btn-sm",onclick:()=>this.deleteListe()},"ðŸ—‘ï¸ Liste lÃ¶schen"));if(e.appendChild(t),this.positionen.length>0){const n=this.getStats(),r=s("div",{className:"row g-3 mb-4"},s("div",{className:"col-4 text-center"},s("div",{className:"p-3 bg-white rounded shadow-sm border"},s("div",{className:"h4 mb-0 fw-bold text-primary"},n.total.toString()),s("div",{className:"small text-muted"},"Gesamt"))),s("div",{className:"col-4 text-center"},s("div",{className:"p-3 bg-white rounded shadow-sm border"},s("div",{className:"h4 mb-0 fw-bold text-danger"},n.open.toString()),s("div",{className:"small text-muted"},"Offen"))),s("div",{className:"col-4 text-center"},s("div",{className:"p-3 bg-white rounded shadow-sm border"},s("div",{className:"h4 mb-0 fw-bold text-success"},n.done.toString()),s("div",{className:"small text-muted"},"Erledigt"))));e.appendChild(r)}const i=new N(this.artikel,(n,r)=>this.addPosition(n,r));if(e.appendChild(i.render()),this.loading)e.appendChild(s("div",{className:"text-center p-4 text-muted"},"Lade Positionen..."));else if(this.positionen.length===0)e.appendChild(s("div",{className:"text-center p-5 text-muted"},s("p",{},"Noch keine Artikel in dieser Liste")));else{const n=s("div",{className:"list-group mt-3"});this.positionen.forEach(r=>{const l=new C(r,(o,h)=>this.togglePosition(o,h),o=>this.deletePosition(o));n.appendChild(l.render())}),e.appendChild(n)}return e}showNewListModal(){const e=new L("Neue Liste erstellen","z.B. Wocheneinkauf",t=>this.createListe(t));this.container.appendChild(e.render())}render(){p(this.container),this.container.appendChild(this.renderHeader());const e=this.renderErrorBanner();e&&this.container.appendChild(e);const t=s("div",{className:"container-lg"}),i=s("div",{className:"row g-0 shadow-sm rounded overflow-hidden border my-4 bg-white"});i.appendChild(this.renderSidebar()),i.appendChild(this.renderMainContent()),t.appendChild(i),this.container.appendChild(t)}}const g=document.getElementById("app");if(!g)throw new Error("App container not found");new k(g);
